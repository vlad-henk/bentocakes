<%# app/views/products/show.html.erb %>
<div class="min-h-screen w-full bg-gradient-to-b from-pink-50 to-white">
  <%= render 'shared/navbar' %>
  
  <div class="container mx-auto px-4 py-8">
    <!-- –•–ª—ñ–±–Ω—ñ –∫—Ä–∏—Ö—Ç–∏ -->
    <nav class="flex space-x-2 text-sm text-rose-600 mb-8">
      <%= link_to '–ì–æ–ª–æ–≤–Ω–∞', root_path, class: 'hover:text-rose-800' %>
      <span>/</span>
      <%= link_to '–ú–µ–Ω—é', products_path, class: 'hover:text-rose-800' %>
      <% if @product.category.present? %>
        <span>/</span>
        <%= link_to @categories[@product.category], products_path(category: @product.category), class: 'hover:text-rose-800' %>
      <% end %>
      <span>/</span>
      <span class="text-rose-900 font-medium"><%= @product.name %></span>
    </nav>
    
    <div class="grid lg:grid-cols-2 gap-12">
      <!-- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É -->
      <div class="h-48 relative overflow-hidden">
        <%= image_tag @product.photo_url(:medium), 
          class: "w-full h-full object-cover hover:scale-105 transition-transform duration-500" %>
      </div>
        
      <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–æ–≤–∞—Ä -->
      <div>
        <h1 class="text-4xl font-bold text-rose-900 mb-4"><%= @product.name %></h1>
        
        <!-- –¶—ñ–Ω–∞ -->
        <div class="mb-6">
          <span class="text-3xl font-bold text-amber-600">
            <%= number_to_currency(@product.price, unit: '‚Ç¥', format: '%n %u') %>
          </span>
        </div>
        
        <!-- –û–ø–∏—Å -->
        <div class="mb-8">
          <h2 class="text-xl font-bold text-rose-800 mb-3">–û–ø–∏—Å</h2>
          <p class="text-rose-700 leading-relaxed"><%= @product.description %></p>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ –∫–æ—Ä–∑–∏–Ω—É -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
          <h3 class="text-lg font-bold text-rose-900 mb-4">–ó–∞–º–æ–≤–∏—Ç–∏</h3>
          
          <%= form_with(url: add_item_cart_path, method: :post, local: true, class: 'space-y-4', data: { turbo: false }) do |f| %>
            <%= f.hidden_field :product_id, value: @product.id %>
            
            <div>
              <label class="block text-rose-700 mb-2">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</label>
              <div class="flex items-center space-x-4">
                <div class="flex items-center border border-rose-200 rounded-full">
                  <button type="button" onclick="decreaseQuantity()" 
                    class="px-4 py-2 text-rose-600 hover:bg-rose-50 rounded-l-full">‚àí</button>
                  <input type="number" id="quantity" name="quantity" value="1" min="1" max="10" 
                    class="w-16 text-center border-0 bg-transparent focus:ring-0">
                  <button type="button" onclick="increaseQuantity()" 
                    class="px-4 py-2 text-rose-600 hover:bg-rose-50 rounded-r-full">+</button>
                </div>
                
                <button type="submit" 
                  class="flex-1 bg-gradient-to-r from-rose-500 to-pink-600 text-white font-bold py-3 px-6 rounded-full hover:shadow-lg transition flex items-center justify-center space-x-2">
                  <span>–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫</span>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                </button>
              </div>
            </div>
          <% end %>
          
          <!-- –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
          <div class="mt-6 pt-6 border-t border-rose-100">
            <div class="flex items-center text-rose-600 text-sm">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>–ì–æ—Ç—É—î–º–æ: 2-4 –≥–æ–¥–∏–Ω–∏</span>
            </div>
          </div>
        </div>
        
        <!-- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
        <div class="bg-rose-50 rounded-2xl p-6">
          <h3 class="text-lg font-bold text-rose-900 mb-4">–î–µ—Ç–∞–ª—ñ</h3>
          <ul class="space-y-2 text-rose-700">
            <li class="flex items-center">
              <svg class="w-5 h-5 text-rose-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span>–°–≤—ñ–∂—ñ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏</span>
            </li>
            <li class="flex items-center">
              <svg class="w-5 h-5 text-rose-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span>–†—É—á–Ω–∞ —Ä–æ–±–æ—Ç–∞</span>
            </li>
            <li class="flex items-center">
              <svg class="w-5 h-5 text-rose-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span>–ë–µ–∑ —à—Ç—É—á–Ω–∏—Ö –±–∞—Ä–≤–Ω–∏–∫—ñ–≤</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- –ü–æ–≤'—è–∑–∞–Ω—ñ —Ç–æ–≤–∞—Ä–∏ -->
    <% if @related_products.any? %>
      <div class="mt-16">
        <h2 class="text-3xl font-bold text-rose-900 mb-8 text-center">–°—Ö–æ–∂—ñ —Ç–æ–≤–∞—Ä–∏</h2>
        
        <div class="grid md:grid-cols-3 gap-6">
          <% @related_products.each do |product| %>
            <% 
              related_background = case product.category
              when 'cakes'
                'from-rose-100 to-pink-200'
              when 'desserts'
                'from-amber-100 to-orange-200'
              else
                'from-blue-100 to-cyan-200'
              end
              
              related_emoji = case product.category
              when 'cakes'
                'üéÇ'
              when 'desserts'
                'üßÅ'
              else
                'üç∞'
              end
            %>
            
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-xl transition">
              <div class="h-40 bg-gradient-to-br <%= related_background %> flex items-center justify-center">
                <span class="text-4xl"><%= related_emoji %></span>
              </div>
              
              <div class="p-4">
                <h3 class="font-bold text-rose-900 mb-2 line-clamp-1"><%= product.name %></h3>
                <p class="text-rose-600 text-sm mb-3 line-clamp-2"><%= product.description %></p>
                
                <div class="flex items-center justify-between">
                  <span class="font-bold text-amber-600">
                    <%= number_to_currency(product.price, unit: '‚Ç¥', format: '%n %u') %>
                  </span>
                  
                  <%= link_to '–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏', product_path(product), 
                        class: 'text-rose-600 hover:text-rose-800 text-sm font-medium' %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  
  <%= render 'shared/footer' %>
</div>

<script>
function increaseQuantity() {
  const input = document.getElementById('quantity');
  const max = parseInt(input.getAttribute('max'));
  if (input.value < max) {
    input.value = parseInt(input.value) + 1;
  }
}

function decreaseQuantity() {
  const input = document.getElementById('quantity');
  const min = parseInt(input.getAttribute('min'));
  if (input.value > min) {
    input.value = parseInt(input.value) - 1;
  }
}
</script>

<style>
.line-clamp-1 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 1;
}

.line-clamp-2 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
}
</style>