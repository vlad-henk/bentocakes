<%# app/views/orders/new.html.erb %>
<div class="min-h-screen w-full bg-gradient-to-b from-pink-50 to-white">
  <%= render 'shared/navbar' %>
  
  <div class="container mx-auto px-4 py-8">
    <!-- –•–ª—ñ–±–Ω—ñ –∫—Ä–∏—Ö—Ç–∏ -->
    <nav class="flex space-x-2 text-sm text-rose-600 mb-8">
      <%= link_to '–ì–æ–ª–æ–≤–Ω–∞', root_path, class: 'hover:text-rose-800' %>
      <span>/</span>
      <%= link_to '–ö–æ—à–∏–∫', cart_path, class: 'hover:text-rose-800' %>
      <span>/</span>
      <span class="text-rose-900 font-medium">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</span>
    </nav>
    
    <h1 class="text-4xl font-bold text-rose-900 mb-8">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
    
    <% if @cart.cart_items.empty? %>
      <div class="text-center py-16">
        <div class="text-8xl mb-6">üõí</div>
        <h2 class="text-3xl font-bold text-rose-900 mb-4">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h2>
        <p class="text-rose-700 mb-8">–î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è–º –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
        <%= link_to '–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –º–µ–Ω—é', products_path,
              class: 'bg-gradient-to-r from-rose-500 to-pink-600 text-white font-bold py-3 px-8 rounded-full hover:shadow-xl transition' %>
      </div>
    <% else %>
      <%= form_with(model: @order, url: orders_path, local: true, class: 'space-y-8') do |f| %>
        <div class="grid lg:grid-cols-3 gap-8">
          <!-- –§–æ—Ä–º–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö -->
          <div class="lg:col-span-2 space-y-8">
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
            <div class="bg-white rounded-3xl shadow-xl p-8">
              <h2 class="text-2xl font-bold text-rose-900 mb-6">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h2>
              
              <div class="space-y-6">
                <div>
                  <%= f.label :phone, "–¢–µ–ª–µ—Ñ–æ–Ω *", class: 'block text-rose-700 mb-2 font-medium' %>
                  <%= f.telephone_field :phone, required: true,
                        class: 'w-full border border-rose-200 rounded-xl p-3 focus:border-rose-300 focus:ring focus:ring-rose-100 transition',
                        placeholder: '+38 (0XX) XXX XX XX' %>
                </div>
                
                <div>
                  <%= f.label :delivery_address, "–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ *", class: 'block text-rose-700 mb-2 font-medium' %>
                  <%= f.text_area :delivery_address, required: true, rows: 3,
                        class: 'w-full border border-rose-200 rounded-xl p-3 focus:border-rose-300 focus:ring focus:ring-rose-100 transition',
                        placeholder: '–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤–Ω—É –∞–¥—Ä–µ—Å—É –¥–æ—Å—Ç–∞–≤–∫–∏' %>
                </div>
              </div>
            </div>
            
            <!-- –ü—Ä–∏–º—ñ—Ç–∫–∏ -->
            <div class="bg-white rounded-3xl shadow-xl p-8">
              <h2 class="text-2xl font-bold text-rose-900 mb-6">–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–±–∞–∂–∞–Ω–Ω—è</h2>
              <%= f.text_area :notes, rows: 4,
                    class: 'w-full border border-rose-200 rounded-xl p-3 focus:border-rose-300 focus:ring focus:ring-rose-100 transition',
                    placeholder: '–í–∞—à—ñ –ø–æ–±–∞–∂–∞–Ω–Ω—è —â–æ–¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è...' %>
            </div>
          </div>
          
          <!-- –ü—ñ–¥—Å—É–º–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
          <div class="lg:col-span-1">
            <div class="bg-white rounded-3xl shadow-xl p-8 sticky top-24">
              <h2 class="text-2xl font-bold text-rose-900 mb-6">–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
              
              <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ -->
              <div class="space-y-4 mb-6 max-h-64 overflow-y-auto pr-2">
                <% @cart.cart_items.each do |item| %>
                  <div class="flex items-center justify-between py-3 border-b border-rose-50 last:border-0">
                    <div class="flex items-center">
                      <div class="w-12 h-12 bg-gradient-to-br from-rose-100 to-amber-100 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-lg">
                          <% 
                            emoji = case item.product.category&.downcase
                            when 'cakes', '—Ç–æ—Ä—Ç–∏'
                              'üéÇ'
                            when 'cupcakes', '–∫–∞–ø–∫–µ–π–∫–∏'
                              'üßÅ'
                            when 'macarons', '–º–∞–∫–∞—Ä–æ–Ω–∏'
                              'üç™'
                            when 'candies', '—Ü—É–∫–µ—Ä–∫–∏'
                              'üç¨'
                            else
                              'üç∞'
                            end
                          %>
                          <%= emoji %>
                        </span>
                      </div>
                      <div>
                        <div class="font-medium text-rose-900 text-sm"><%= item.product.name.truncate(20) %></div>
                        <div class="flex items-center space-x-2 text-xs text-rose-600">
                          <span><%= item.quantity %> —à—Ç.</span>
                          <span>√ó</span>
                          <span><%= item.product.price %> ‚Ç¥</span>
                        </div>
                      </div>
                    </div>
                    <span class="font-medium text-rose-900 whitespace-nowrap">
                      <%= number_to_currency(item.total_price, unit: '‚Ç¥', format: '%n %u') %>
                    </span>
                  </div>
                <% end %>
              </div>
              
              <!-- –ü—ñ–¥—Å—É–º–æ–∫ -->
              <div class="border-t border-rose-200 pt-6 mt-6">
                <div class="space-y-3 mb-6">
                  <div class="flex justify-between text-rose-700">
                    <span>–¢–æ–≤–∞—Ä–∏:</span>
                    <span class="font-medium"><%= @cart.total_items %> —à—Ç.</span>
                  </div>
                  <div class="border-t border-rose-200 pt-3 mt-3">
                    <div class="flex justify-between text-lg font-bold text-rose-900">
                      <span>–í—Å—å–æ–≥–æ:</span>
                      <span class="text-amber-600"><%= number_to_currency(@cart.total_price, unit: '‚Ç¥') %></span>
                    </div>
                  </div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
                <div class="mt-8">
                  <%= f.submit '–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è',
                        class: 'w-full bg-gradient-to-r from-rose-500 to-pink-600 text-white font-bold py-4 rounded-xl hover:shadow-xl transition shadow-lg cursor-pointer text-lg hover:scale-[1.02] active:scale-[0.98]' %>
                </div>
                
                <!-- –£–º–æ–≤–∏ -->
                <div class="mt-6 text-center">
                  <p class="text-xs text-rose-500">
                    –ù–∞—Ç–∏—Å–∫–∞—é—á–∏ –∫–Ω–æ–ø–∫—É, –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—å –∑ 
                    <%= link_to '—É–º–æ–≤–∞–º–∏ –æ–±—Ä–æ–±–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö', '#', 
                          class: 'text-rose-600 hover:text-rose-800 underline underline-offset-2' %>
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
  
  <%= render 'shared/footer' %>
</div>